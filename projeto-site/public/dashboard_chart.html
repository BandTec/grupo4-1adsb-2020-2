<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link rel="shortcut icon" href="img/esculápio.png">
	<link rel="stylesheet" href="dashboard_chart.css">
	<!-- script do google charts -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="funcoes.js"></script>


</head>

<body onload="atualizacaoPeriodica()">
	<!--HEADER-->

	<div class="header">
		<div class="header2">
			<a href="index.html"><img src="img/logo_home_color_dark.png" alt=""></a>

			<!--nav-->
			<div class="nav">
				<ul>
					<li>Olá, <b id="b_usuario"></b></li>
					<li><a href="#" onclick="logoff()">Sair</a></li>

				</ul>
			</div>
		</div>
	</div>
	<!--end nav-->

	<h1 id="titulo_medicoes">TEMPERATURAS CRÍTICAS (°C)</h1>
	<div class="analytics">
		<p id="alta">ALTA</p>
		<p id="baixa">BAIXA</p>
	</div>

	<div class="bloco_temperatura">

		<a href="tela1.html">
			<div id="campo1" class="temperatura1">
				<p>F. Brandão</p>
				<h2>37.9º</h2>
				<span><b>Setor 1</b></span>
			</div>
		</a>


		<div class="temperatura1">
			<p>Roberto Silva</p>
			<h2>39°</h2>
			<span><b>Setor 2</b></span>
		</div>


		<div class="temperatura1">
			<p>Julio Santos</p>
			<h2>39°</h2>
			<span><b>Setor 2</b></span>
		</div>



		<div class="temperatura2">
			<p>Joana Roberta</p>
			<h2>34°</h2>
			<span><b>Setor 2</b></span>
		</div>

		<div class="temperatura2">
			<p>Natan Oliveira</p>
			<h2>34°</h2>
			<span><b>Setor 2</b></span>
		</div>

		<a href="tela2.html">
			<div class="temperatura2">
				<p>Eduardo Verri</p>
				<h2>34°</h2>
				<span><b>Setor 2</b></span>
			</div>
		</a>
		
		<div class="temperatura2">
			<p>Fabio da Silva</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>


		<div class="temperatura2">
			<p>Julia Abraão</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>


		<div class="temperatura1">
			<p>Cida Moura</p>
			<h2>39°</h2>
			<span><b>Setor 3</b></span>
		</div>



		<div class="temperatura2">
			<p>Kevin Santos</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>


		<div class="temperatura1">
			<p>Bianca Costa</p>
			<h2>39°</h2>
			<span><b>Setor 3</b></span>
		</div>



		<div class="temperatura2">
			<p>Vinicius Carvalho</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>



		<div class="temperatura2">
			<p>Martin Santana</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>

		<a href="tela3.html">
			<div class="temperatura1">
				<p>Kaline Barreira</p>
				<h2>39°</h2>
				<span><b>Setor 3</b></span>
			</div>
		</a>



		<div class="temperatura2">
			<p>Thiago Bonacelli</p>
			<h2>34°</h2>
			<span><b>Setor 2</b></span>
		</div>

		<a href="tela4.html">
		<div class="temperatura2">
			<p>Claudio Frizzarini</p>
			<h2>34°</h2>
			<span><b>Setor 2</b></span>
		</div>
		</a>

		<div class="temperatura2">
			<p>Celia Taniwaki</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>



		<div class="temperatura2">
			<p>Vivian Silva</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>



		<div class="temperatura1">
			<p>Giuliana Miniguit</p>
			<h2>39°</h2>
			<span><b>Setor 1</b></span>
		</div>



		<div class="temperatura1">
			<p>Gustavo Jesus</p>
			<h2>39°</h2>
			<span><b>Setor 2</b></span>
		</div>
	</div>


	<!--footer-->
	<div class="footer" id="contato">
		<div class="contaner_footer">
			<ul>
				<li><a><img src="img/icons/facebook.png" alt=""></a></li>
				<li><a target="_blank" href="https://github.com/Projeto-PI-Grupo-4/Health-Analytics"><img
							src="img/icons/github.png" alt=""></a></li>
				<li><a><img src=" img/icons/twitter.png" alt=""></a></li>
				<li><a><img src="img/icons/linkedin.png" alt=""></a></li>
			</ul>
		</div>

		<!--footer finish-->
</body>

</html>

<script>
	// <![CDATA[ 
	var ttChatLoaderS = document.createElement('script');
	document.tomticketChatLoaderScriptVersion = 2;
	ttChatLoaderS.src = 'https://health-analytics-2020.tomticket.com/scripts-chat/chat.min.js' +
		'?id=EP51036' +
		'&account=3266304P30112020054447' +
		'&autoOpen=0' +
		'&hideWhenOffline=0' +
		'&d=health-analytics-2020' +
		'&ts=' + new Date().getTime() +
		'&ref=' + encodeURIComponent(document.URL);
	document.body.appendChild(ttChatLoaderS);
	//]]>



	let usuario;



	// só mexer se quiser alterar o tempo de atualização
	// ou se souber o que está fazendo!
	function atualizacaoPeriodica() {
		obterdadosporleitura(1);
		obterdadosporleitura(2);
		obterdadosporleitura(3);
		obterdadosporleitura(4);
		setTimeout(atualizacaoPeriodica, 5000);
	}



	function obterdadosporleitura(idleitura) {
		//aguardar();
		fetch(`/leituras/tempo-real/${idleitura}`)
			.then(resposta => {

				if (resposta.ok) {
					resposta.json().then(function (resposta) {

						console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

						// aqui, após registro. use os nomes 
						// dos atributos que vem no JSON 
						var dados = {
							temperatura: resposta.temperatura,
						}

						alertar(resposta.temperatura, idleitura);
						atualizarTela(dados, idleitura);
					});
				} else {

					console.error('Nenhum dado encontrado ou erro na API');
				}
			})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados do caminhao p/ gráfico: ${error.message}`);
			});
	}

	function alertar(temperatura, idleitura) {
		// padrão para meu alerta
		var limites = {
			max_temperatura: 40,
			min_temperatura: 20
		};

		// zerar aviso de mensagem
		var mensagem_temperatura = '';
		var classe_temperatura = 'alerta';

		// comparando
		if (temperatura > limites.max_temperatura) {
			mensagem_temperatura += 'Temperatura alta demais! <br>';
			classe_temperatura = 'alerta alerta-alto';
		}

		if (temperatura < limites.min_temperatura) {
			mensagem_temperatura = 'Temperatura baixa demais! <br>';
			classe_temperatura = 'alerta alerta-baixo';
		}


		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_alerta_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_alerta_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_alerta_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_alerta_temperatura4

		}

		// alterando
		div_temperatura_alterar.innerHTML = mensagem_temperatura;
		div_temperatura_alterar.className = classe_temperatura;
	}

	// só altere aqui se souber o que está fazendo!
	function atualizarTela(dados, idleitura) {
		console.log('iniciando atualização da tela...');

		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_temperatura4
		}

		div_temperatura_alterar.innerHTML = `Temperatura: ${dados.temperatura}º`;

	}


	function sendData() {
		var http = new XMLHttpRequest();
		http.open('GET', 'http://localhost:9000/api/sendData', false);
		http.send(null);
	}

	setInterval(() => {
		sendData();
	}, 5000);
</script>