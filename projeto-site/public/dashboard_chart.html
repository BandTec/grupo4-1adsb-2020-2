<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link rel="shortcut icon" href="img/esculápio.png">
	<link rel="stylesheet" href="dashboard_chart.css">
	<!-- script do google charts -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="funcoes.js"></script>

	<style>
        /* Classes CSS para exemplos de alertas */

        .normal {
            background-color: green;
        }

        .alerta-alto {
            background-color: red;
            
        }

        .alerta-baixo {
            background-color: rgb(36, 193, 214);
            
        }
    </style>
</head>

<body onload="atualizacaoPeriodica()">
	<!--HEADER-->

	<div class="header">
		<a href="index.html"><img src="img/logo_home_color_dark.png" alt=""></a>
		<h2 id="titulo1" style="text-align: center; margin-bottom: 100px; font-size: 40pt;">Todos os alertas críticos:</h2>

		
		<h3 style="font-size: 29pt;">OLÁ <b id="b_usuario"></b>:<select id="setoresGerais" onchange="setores()" style="width: 260px; font-size:20pt;">
			<option value="">Selecione um setor</option>
			<option value="allsectors">Todos setores</option>
			<option value="setor1">Setor 1</option>
			<option value="setor2">Setor 2</option>
		</select></h3>
		
		<div id="div_alertas_criticos">
			<div id="temperatura-criticas" style="display: none;"></div>
			<a href="tela1.html">
			<div id="div_alerta_temperatura"  class="temperatura1">
				<p name="nameleitura" id="idleitura" value="1">1</p>
				<h2 id="div_temperatura">0º</h2>
				<span><b>Setor 1</b></span>
			</div>
		</a>
			


		<div id="div_alerta_temperatura2" class="temperatura1">
			<p name="nameleitura" id="idleitura" value="2">2</p>
			<h2 id="div_temperatura2">0°</h2>
			<span><b>Setor 2</b></span>
		</div>
			


		<div id="div_alerta_temperatura3" class="temperatura1">
			<p name="nameleitura" id="idleitura" value="3">3</p>
			<h2 id="div_temperatura3">0°</h2>
			<span><b>Setor 2</b></span>
		</div>
			



		<div id="div_alerta_temperatura4" class="temperatura1">
			<p name="nameleitura" id="idleitura" value="4">4</p>
			<h2 id="div_temperatura4">0°</h2>
			<span><b>Setor 2</b></span>
		</div>
			

		
		<div class="temperatura1">
			<p>Natan Oliveira</p>
			<h2>34°</h2>
			<span><b>Setor 2</b></span>
		</div>

		<a href="tela2.html">
		<div class="temperatura1">
				<p>Eduardo Verri</p>
				<h2>34°</h2>
				<span><b>Setor 2</b></span>
			</div>
		</a>
			
		<div class="temperatura1">
			<p>Fabio da Silva</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>


		<div class="temperatura1">
			<p>Julia Abraão</p>
			<h2>34°</h2>
			<span><b>Setor 1</b></span>
		</div>


		<div class="temperatura1">
			<p>Cida Moura</p>
			<h2>39°</h2>
			<span><b>Setor 3</b></span>
		</div>


		
		<div class="temperatura1">
			<p>Kevin Santos</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>


		<div class="temperatura1">
			<p>Bianca Costa</p>
			<h2>39°</h2>
			<span><b>Setor 3</b></span>
		</div>


		<div class="temperatura1">
			<p>Vinicius Carvalho</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>



		<div class="temperatura1">
			<p>Martin Santana</p>
			<h2>34°</h2>
			<span><b>Setor 3</b></span>
		</div>

		<a href="tela3.html">
			<div class="temperatura1">
				<p>Kaline Barreira</p>
				<h2>39°</h2>
				<span><b>Setor 3</b></span>
			</div>
		</a>

		</div>
		

		
		<div style="display: none;" id="div_alerta_temperatura5" class="temperatura1">
			<div class="temperatura1">
				<p>Thiago Bonacelli</p>
				<h2>34°</h2>
				<span><b>Setor 2</b></span>
			</div>

			<a href="tela4.html">
			<div class="temperatura1">
					<p>Claudio Frizzarini</p>
					<h2>34°</h2>
				<span><b>Setor 2</b></span>
			</div>
			</a>

			<div class="temperatura1">
				<p>Celia Taniwaki</p>
				<h2>34°</h2>
				<span><b>Setor 1</b></span>
			</div>



			<div class="temperatura1">
				<p>Vivian Silva</p>
				<h2>34°</h2>
				<span><b>Setor 1</b></span>
			</div>
		</div>


		<!-- <div class="temperatura1">
			<p>Giuliana Miniguit</p>
			<h2>39°</h2>
			<span><b>Setor 1</b></span>
		</div>



		<div class="temperatura1">
			<p>Gustavo Jesus</p>
			<h2>39°</h2>
			<span><b>Setor 2</b></span>
		</div> -->
	</div> 

	<!--footer-->
	<div class="footer" id="contato">
		<ul>
			<li><a><img src="img/icons/facebook.png" alt=""></a></li>
			<li><a target="_blank" href="https://github.com/Projeto-PI-Grupo-4/Health-Analytics"><img
						src="img/icons/github.png" alt=""></a></li>
			<li><a><img src=" img/icons/twitter.png" alt=""></a></li>
			<li><a><img src="img/icons/linkedin.png" alt=""></a></li>
		</ul>
	</div>
	<!--footer finish-->
</body>
</html>

<script>

	// função da select dos setores
	function setores(){
		if(setoresGerais.value == 'setor1'){
			div_alertas_criticas.style.display = 'none'
			titulo1.style.display = 'none';
			div_alerta_temperatura5.style.display = 'block';
		}
	}


	// <![CDATA[ 
	var ttChatLoaderS = document.createElement('script');
	document.tomticketChatLoaderScriptVersion = 2;
	ttChatLoaderS.src = 'https://health-analytics-2020.tomticket.com/scripts-chat/chat.min.js' +
		'?id=EP51036' +
		'&account=3266304P30112020054447' +
		'&autoOpen=0' +
		'&hideWhenOffline=0' +
		'&d=health-analytics-2020' +
		'&ts=' + new Date().getTime() +
		'&ref=' + encodeURIComponent(document.URL);
	document.body.appendChild(ttChatLoaderS);
	//]]>



	// let usuario;
    
    // verificar_autenticacao();



	// só mexer se quiser alterar o tempo de atualização
	// ou se souber o que está fazendo!
	function atualizacaoPeriodica() {
		obterdadosporleitura(1);
		obterdadosporleitura(2);
		obterdadosporleitura(3);
		obterdadosporleitura(4);
		setTimeout(atualizacaoPeriodica, 5000);
	}



	function obterdadosporleitura(idleitura) {
		//aguardar();
		fetch(`/leituras/tempo-real/${idleitura}`)
			.then(resposta => {

				if (resposta.ok) {
					resposta.json().then(function (resposta) {

						console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

						// aqui, após registro. use os nomes 
						// dos atributos que vem no JSON 
						var dados = {
							temperatura: resposta.temperatura
						}

						alertar(resposta.temperatura, idleitura);
						atualizarTela(dados, idleitura);
					});
				} else {

					console.error('Nenhum dado encontrado ou erro na API');
				}
			})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados do usuario p/ gráfico: ${error.message}`);
			});
	}

	function alertar(temperatura, idleitura) {
		// padrão para meu alerta
		var limites = {
			max_temperatura: 37.8,
			min_temperatura: 35.5
		};

		// zerar aviso de mensagem
		
		var classe_temperatura = 'temperatura1';

		// comparando
		if (temperatura > limites.max_temperatura) {
		
			classe_temperatura = 'temperatura1 alerta-alto';
		}

		if (temperatura < limites.min_temperatura) {
			
			classe_temperatura = 'temperatura1 alerta-baixo';
		}

		if(temperatura >= limites.min_temperatura && temperatura <= limites.max_temperatura){
			classe_temperatura = 'temperatura1 normal';
		}


		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_alerta_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_alerta_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_alerta_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_alerta_temperatura4

		}

		// alterando
		
		div_temperatura_alterar.className = classe_temperatura;
	}

	// só altere aqui se souber o que está fazendo!
	function atualizarTela(dados, idleitura) {
		console.log('iniciando atualização da tela...');

		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_temperatura4
		}

		div_temperatura_alterar.innerHTML = `${dados.temperatura.toFixed(2)}`;

	}


	function sendData() {
		var http = new XMLHttpRequest();
		http.open('GET', 'http://localhost:9000/api/sendData', false);
		http.send(null);
	}

	setInterval(() => {
		sendData();
	}, 5000);
</script>