<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link rel="shortcut icon" href="img/esculápio.png">
	<link rel="stylesheet" href="dashboard_chart.css">
	<!-- script do google charts -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="funcoes.js"></script>

	<style>
		/* Classes CSS para exemplos de alertas */

		.normal {
			background-color: green;
		}

		.alerta-alto {
			background-color: red;

		}

		.alerta-baixo {
			background-color: rgb(36, 193, 214);

		}
	</style>
</head>

<body onload="atualizacaoPeriodica()">
	<!--HEADER-->

	<div class="header">
		<a href="login.html"></a>
		<a href="index.html"><img src="img/logo_home_color_dark.png" alt=""></a>
		<h2 id="titulo1" style="text-align: center; margin-bottom: 100px; font-size: 40pt;">Todos os alertas críticos:
		</h2>
		<h2 id="titulo2" style="text-align: center; display: none; margin-bottom: 100px; font-size: 40pt;">Setor 1:</h2>
		<h2 id="titulo3" style="text-align: center; display: none; margin-bottom: 100px; font-size: 40pt;">Setor 2:</h2>
		<h2 id="titulo4" style="text-align: center; display: none; margin-bottom: 100px; font-size: 40pt;">Criticos:</h2>

		<h3 style="font-size: 29pt;">OLÁ <b id="b_usuario"></b>:
			<select id="setoresGerais" onchange="setores()" style="width: 260px; font-size:20pt;">
				<option value="">Selecione um setor</option>
				<option value="aletas_criticos"> Criticos</option>
				<option id="op_setor1" value="setor1">Setor 1</option>
				<option id="op_setor2" value="setor2">Setor 2</option>
				<option id="todosSetores" style="display: none;" value="allsectors">Todos setores</option>
			</select></h3>

		<div id="geral">

			<div id="div_alertas_criticos">
				<a style="color: black;" href="tela1.html">
					<div id="div_alerta_temperatura" class="temperatura1">
						<p name="nameleitura" id="idleitura" value="1">Marcos Santos</p>
						<h2 id="div_temperatura">0º</h2>
						<span><b>Setor 1</b></span>
					</div>
				</a>


				<a style="color: black;" href="tela2.html">
					<div id="div_alerta_temperatura2" class="temperatura1">
						<p name="nameleitura" id="idleitura" value="2">Maria Clara Silva</p>
						<h2 id="div_temperatura2">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>

				<a style="color: black;" href="tela3.html">
					<div id="div_alerta_temperatura3" class="temperatura1">
						<p name="nameleitura" id="idleitura" value="3">Rogerio Souza </p>
						<h2 id="div_temperatura3">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>


				<a style="color: black;" href="tela4.html">
					<div id="div_alerta_temperatura4" class="temperatura1">
						<p name="nameleitura" id="idleitura" value="4"> Larissa Paula</p>
						<h2 id="div_temperatura4">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>


				<div class="temperatura1 alerta-baixo">
					<p>Natan Oliveira</p>
					<h2>33°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-baixo">
					<p>Eduardo Verri</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Fabio da Silva</p>
					<h2>36°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Julia Abraão</p>
					<h2>37°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 3</b></span>
				</div>



				<div class="temperatura1 alerta-baixo">
					<p>Kevin Santos</p>
					<h2>33°</h2>
					<span><b>Setor 3</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Bianca Costa</p>
					<h2>38.9°</h2>
					<span><b>Setor 3</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Vinicius Carvalho</p>
					<h2>36°</h2>
					<span><b>Setor 3</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Martin Santana</p>
					<h2>37°</h2>
					<span><b>Setor 3</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 3</b></span>
				</div>

			</div>


			<div style="display: none;" id="div_alerta_temperatura5">

				<div class="temperatura1 alerta-baixo">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Claudio Frizzarini</p>
					<h2>36°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-baixo">
					<p>Celia Taniwaki</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-baixo">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Giuliana Miniguit</p>
					<h2>39°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Gustavo Jesus</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>


			<div style="display: none;" id="div_alerta_temperatura6">

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>40.2°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-baixo">
					<p>Tania Costa</p>
					<h2>35°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-baixo">
					<p>Maria Julia</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Guilherme Oliveira</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>



            
			<div style="display: none;" id="div_alerta_temperatura7">

				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Celia Taniwaki</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Eduardo Verri</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Natan Oliveira</p>
					<h2>33°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Bianca Costa</p>
					<h2>38.9°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Tania Costa</p>
					<h2>35°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Maria Julia</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Guilherme Oliveira</p>
					<h2>38°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>


		</div>
	</div>

	<!--footer-->
	<div class="footer" id="contato">
		<ul>
			<li><a><img src="img/icons/facebook.png" alt=""></a></li>
			<li><a target="_blank" href="https://github.com/Projeto-PI-Grupo-4/Health-Analytics"><img
						src="img/icons/github.png" alt=""></a></li>
			<li><a><img src=" img/icons/twitter.png" alt=""></a></li>
			<li><a><img src="img/icons/linkedin.png" alt=""></a></li>
		</ul>
	</div>
	<!--footer finish-->
</body>

</html>

<script>

	// função da select dos setores
	function setores() {

		if (setoresGerais.value == 'setor1') {
			titulo2.style.display = 'block';
			div_alertas_criticos.style.display = 'none';
			titulo1.style.display = 'none';
			div_alerta_temperatura5.style.display = 'block';
			div_alerta_temperatura6.style.display = 'none';
			div_alerta_temperatura7.style.display = 'none';
			titulo3.style.display = 'none';
			todosSetores.style.display = 'block';
			op_setor2.style.display = 'block';
			titulo4.style.display = 'none';
			

		} else if (setoresGerais.value == '') {
			geral.style.display = 'none';
			titulo1.style.display = 'none';
			titulo2.style.display = 'none';
			titulo3.style.display = 'none';
			titulo4.style.display = 'none';
			alert('Favor selecione um setor')
		}
		else if (setoresGerais.value == 'allsectors') {

			div_alertas_criticos.style.display = 'block';
			titulo1.style.display = 'block';
			titulo2.style.display = 'none';
			titulo3.style.display = 'none';
			div_alerta_temperatura6.style.display = 'none';
			div_alerta_temperatura5.style.display = 'none';
			todosSetores.style.display = 'none';
			op_setor2.style.display = 'block';
			titulo4.style.display = 'none';


		} else if (setoresGerais.value == 'setor2') {

			titulo3.style.display = 'block';
			titulo2.style.display = 'none';
			titulo1.style.display = 'none';
			div_alerta_temperatura5.style.display = 'none';
			div_alerta_temperatura6.style.display = 'block';
			div_alertas_criticos.style.display = 'none';
			todosSetores.style.display = 'block';
			op_setor2.style.display = 'none';
			titulo4.style.display = 'none';

		} else if (setoresGerais.value == 'aletas_criticos'){
			titulo4.style.display = 'block';
			titulo3.style.display = 'none';
		    titulo2.style.display = 'none';
		    titulo1.style.display = 'none';
		    div_alerta_temperatura5.style.display = 'none';
			div_alerta_temperatura6.style.display = 'none';
			div_alerta_temperatura7.style.display = 'block';
		    div_alertas_criticos.style.display = 'none';
		    todosSetores.style.display = 'block';
			op_setor2.style.display = 'none';
		}	
	}

	// <![CDATA[ 
	var ttChatLoaderS = document.createElement('script');
	document.tomticketChatLoaderScriptVersion = 2;
	ttChatLoaderS.src = 'https://health-analytics-2020.tomticket.com/scripts-chat/chat.min.js' +
		'?id=EP51036' +
		'&account=3266304P30112020054447' +
		'&autoOpen=0' +
		'&hideWhenOffline=0' +
		'&d=health-analytics-2020' +
		'&ts=' + new Date().getTime() +
		'&ref=' + encodeURIComponent(document.URL);
	document.body.appendChild(ttChatLoaderS);
	//]]>



	// let usuario;

	// verificar_autenticacao();



	// só mexer se quiser alterar o tempo de atualização
	// ou se souber o que está fazendo!
	function atualizacaoPeriodica() {
		obterdadosporleitura(1);
		obterdadosporleitura(2);
		obterdadosporleitura(3);
		obterdadosporleitura(4);
		setTimeout(atualizacaoPeriodica, 5000);
	}



	function obterdadosporleitura(idleitura) {
		//aguardar();
		fetch(`/leituras/tempo-real/${idleitura}`)
			.then(resposta => {

				if (resposta.ok) {
					resposta.json().then(function (resposta) {

						console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

						// aqui, após registro. use os nomes 
						// dos atributos que vem no JSON 
						var dados = {
							temperatura: resposta.temperatura
						}

						alertar(resposta.temperatura, idleitura);
						atualizarTela(dados, idleitura);
					});
				} else {

					console.error('Nenhum dado encontrado ou erro na API');
				}
			})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados do usuario p/ gráfico: ${error.message}`);
			});
	}

	function alertar(temperatura, idleitura) {
		// padrão para meu alerta
		var limites = {
			max_temperatura: 37.8,
			min_temperatura: 35.5
		};

		// zerar aviso de mensagem

		var classe_temperatura = 'temperatura1';

		// comparando
		if (temperatura > limites.max_temperatura) {

			classe_temperatura = 'temperatura1 alerta-alto';
		}

		if (temperatura < limites.min_temperatura) {

			classe_temperatura = 'temperatura1 alerta-baixo';
		}

		if (temperatura >= limites.min_temperatura && temperatura <= limites.max_temperatura) {
			classe_temperatura = 'temperatura1 normal';
		}


		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_alerta_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_alerta_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_alerta_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_alerta_temperatura4

		}

		// alterando

		div_temperatura_alterar.className = classe_temperatura;
	}

	// só altere aqui se souber o que está fazendo!
	function atualizarTela(dados, idleitura) {
		console.log('iniciando atualização da tela...');

		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_temperatura4
		}

		div_temperatura_alterar.innerHTML = `${dados.temperatura.toFixed(2)}`;

	}


	function sendData() {
		var http = new XMLHttpRequest();
		http.open('GET', 'http://localhost:9000/api/sendData', false);
		http.send(null);
	}

	setInterval(() => {
		sendData();
	}, 5000);
</script>